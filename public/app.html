<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CARERING Healthcare - SPA</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FF9966">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SPA CORE STYLES - Hide/Show Pages
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Prevent flash of content */
    .mobile-wrapper {
      min-height: 100vh;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PERANGKAT PAGE STYLES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .device-hero {
      text-align: center;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .device-hero img {
      width: 140px;
      filter: drop-shadow(8px 8px 16px rgba(163, 177, 198, 0.4)) drop-shadow(-8px -8px 16px rgba(255, 255, 255, 0.3));
      animation: float 4s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }

    .device-section-title {
      font-size: 1.6em;
      font-weight: 700;
      text-align: center;
      margin-bottom: 15px;
    }

    .device-card {
      background: #e0e5ec;
      padding: 22px;
      border-radius: 22px;
      box-shadow:
        9px 9px 16px rgba(163, 177, 198, 0.6),
        -9px -9px 16px rgba(255, 255, 255, 0.5);
      animation: fadeInUp .4s ease;
      border: none;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .device-name {
      font-size: 1.4em;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .battery-bar {
      height: 10px;
      background: #e0e5ec;
      border-radius: 10px;
      margin-top: 6px;
      overflow: hidden;
      box-shadow:
        inset 3px 3px 6px rgba(163, 177, 198, 0.5),
        inset -3px -3px 6px rgba(255, 255, 255, 0.5);
    }

    .battery-fill {
      height: 100%;
      width: 0%;
      background: #27AE60;
      border-radius: 10px;
      transition: width .5s ease;
      box-shadow:
        2px 2px 4px rgba(39, 174, 96, 0.3),
        -2px -2px 4px rgba(46, 204, 113, 0.2);
    }

    .device-actions {
      margin-top: 20px;
      display: grid;
      gap: 12px;
    }

    .action-btn {
      background: #e0e5ec;
      padding: 14px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      box-shadow:
        6px 6px 12px rgba(163, 177, 198, 0.6),
        -6px -6px 12px rgba(255, 255, 255, 0.5);
      transition: all 0.3s;
      border: none;
    }

    .action-btn:hover {
      box-shadow:
        inset 4px 4px 8px rgba(163, 177, 198, 0.5),
        inset -4px -4px 8px rgba(255, 255, 255, 0.5);
    }

    .action-btn span {
      font-size: 26px;
      color: #4a90e2;
    }

    .action-btn-disconnect {
      background: #e0e5ec !important;
    }

    .action-btn-disconnect:hover {
      box-shadow:
        inset 4px 4px 8px rgba(163, 177, 198, 0.5),
        inset -4px -4px 8px rgba(255, 255, 255, 0.5) !important;
    }

    .action-btn-disconnect span {
      color: #E74C3C !important;
    }

    .no-devices {
      text-align: center;
      padding: 28px;
      background: #e0e5ec;
      border-radius: 20px;
      margin-top: 20px;
      box-shadow:
        9px 9px 16px rgba(163, 177, 198, 0.6),
        -9px -9px 16px rgba(255, 255, 255, 0.5);
      border: none;
    }

    .add-device-btn {
      transition: all 0.3s ease;
      background: #4a90e2 !important;
      box-shadow:
        6px 6px 12px rgba(46, 95, 153, 0.4),
        -6px -6px 12px rgba(74, 144, 226, 0.3) !important;
    }

    .add-device-btn:hover {
      box-shadow:
        inset 4px 4px 8px rgba(46, 95, 153, 0.4),
        inset -4px -4px 8px rgba(74, 144, 226, 0.3) !important;
      transform: translateY(-1px);
    }

    /* BLE Modal */
    .ble-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .ble-modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ble-modal-content {
      background: #e0e5ec;
      border-radius: 24px;
      padding: 28px;
      width: 90%;
      max-width: 500px;
      box-shadow:
        9px 9px 16px rgba(163, 177, 198, 0.6),
        -9px -9px 16px rgba(255, 255, 255, 0.5);
      position: relative;
      border: none;
    }

    .ble-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .ble-modal-title {
      font-size: 1.5em;
      font-weight: 700;
      color: #333;
    }

    .ble-close-btn {
      background: #e0e5ec;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
      box-shadow:
        4px 4px 8px rgba(163, 177, 198, 0.6),
        -4px -4px 8px rgba(255, 255, 255, 0.5);
    }

    .ble-close-btn:hover {
      box-shadow:
        inset 3px 3px 6px rgba(163, 177, 198, 0.5),
        inset -3px -3px 6px rgba(255, 255, 255, 0.5);
      color: #E74C3C;
    }

    .ble-input-group {
      margin-bottom: 20px;
    }

    .ble-input-label {
      display: block;
      font-size: 0.9em;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }

    .ble-input {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 1em;
      transition: all 0.3s;
      box-sizing: border-box;
      background: #e0e5ec;
      color: #333;
      box-shadow:
        inset 4px 4px 8px rgba(163, 177, 198, 0.5),
        inset -4px -4px 8px rgba(255, 255, 255, 0.5);
    }

    .ble-input:focus {
      outline: none;
      box-shadow:
        inset 5px 5px 10px rgba(163, 177, 198, 0.6),
        inset -5px -5px 10px rgba(255, 255, 255, 0.6);
    }

    .ble-progress {
      display: none;
      width: 100%;
      height: 6px;
      background: #e0e5ec;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
      box-shadow:
        inset 3px 3px 6px rgba(163, 177, 198, 0.5),
        inset -3px -3px 6px rgba(255, 255, 255, 0.5);
    }

    .ble-progress.show {
      display: block;
    }

    .ble-progress-bar {
      height: 100%;
      background: #4a90e2;
      width: 0%;
      animation: progress 1.5s ease-in-out infinite;
      border-radius: 10px;
    }

    @keyframes progress {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }

    .ble-connect-btn {
      width: 100%;
      padding: 16px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
      box-shadow:
        6px 6px 12px rgba(46, 95, 153, 0.4),
        -6px -6px 12px rgba(74, 144, 226, 0.3);
    }

    .ble-connect-btn:hover:not(:disabled) {
      box-shadow:
        inset 4px 4px 8px rgba(46, 95, 153, 0.4),
        inset -4px -4px 8px rgba(74, 144, 226, 0.3);
      transform: translateY(-1px);
    }

    .ble-connect-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .ble-message {
      margin-top: 16px;
      padding: 12px;
      border-radius: 12px;
      font-size: 0.9em;
      display: none;
      border: none;
    }

    .ble-message.show {
      display: block;
    }

    .ble-message.success {
      background: #e0e5ec;
      color: #27AE60;
      box-shadow:
        inset 3px 3px 6px rgba(163, 177, 198, 0.4),
        inset -3px -3px 6px rgba(255, 255, 255, 0.4);
      border-left: 4px solid #27AE60;
    }

    .ble-message.error {
      background: #e0e5ec;
      color: #E74C3C;
      box-shadow:
        inset 3px 3px 6px rgba(163, 177, 198, 0.4),
        inset -3px -3px 6px rgba(255, 255, 255, 0.4);
      border-left: 4px solid #E74C3C;
    }

    .ble-message.info {
      background: #e0e5ec;
      color: #4a90e2;
      box-shadow:
        inset 3px 3px 6px rgba(163, 177, 198, 0.4),
        inset -3px -3px 6px rgba(255, 255, 255, 0.4);
      border-left: 4px solid #4a90e2;
    }
  </style>
</head>
<body>

  <div class="mobile-wrapper">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SHARED HEADER (Persisten di semua pages)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="app-header">
        <div class="logo" style="cursor: pointer;" data-navigate="home">
            <span class="logo-care">Care</span><span class="logo-ring">Ring</span>
        </div>

        <div class="profile-icon" data-navigate="profil">
            <img id="nav-user-photo" src="" alt="Profile" style="display: none;">
            <span class="material-symbols-outlined">person</span>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE CONTAINER - Semua halaman ada di sini
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main id="page-container">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: HOME / DASHBOARD
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-home" class="page active container">

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             HERO SECTION - MODERN GREETING
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-greeting" id="user-greeting">Memuat...</h1>
                <p class="hero-subtitle">Monitor kesehatan Anda secara real-time dengan teknologi modern</p>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             QUICK SEARCH
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="search-bar">
            <span class="search-icon"><span class="material-symbols-outlined">search</span></span>
            <input type="text" placeholder="Cari data kesehatan, artikel, atau diskusi...">
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             QUICK ACCESS CATEGORIES
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="quick-access-section">
            <h2 class="section-title-modern">Akses Cepat</h2>
            <div class="categories-grid">
                <div class="category-card-modern" data-navigate="perangkat">
                    <div class="category-icon-wrapper">
                        <span class="material-symbols-outlined">devices</span>
                    </div>
                    <h3 class="category-title">Device</h3>
                    <p class="category-desc">Kelola perangkat</p>
                </div>
                <div class="category-card-modern" data-navigate="ai-chat">
                    <div class="category-icon-wrapper">
                        <span class="material-symbols-outlined">smart_toy</span>
                    </div>
                    <h3 class="category-title">AI Assistant</h3>
                    <p class="category-desc">Chat dengan AI</p>
                </div>
                <div class="category-card-modern" data-navigate="forum">
                    <div class="category-icon-wrapper">
                        <span class="material-symbols-outlined">forum</span>
                    </div>
                    <h3 class="category-title">Forum</h3>
                    <p class="category-desc">Diskusi komunitas</p>
                </div>
                <div class="category-card-modern" data-navigate="news">
                    <div class="category-icon-wrapper">
                        <span class="material-symbols-outlined">newspaper</span>
                    </div>
                    <h3 class="category-title">Berita</h3>
                    <p class="category-desc">Update terkini</p>
                </div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             FEATURED METRIC - HERO CARD
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="featured-metric-section">
            <h2 class="section-title-modern">Status Kesehatan Utama</h2>
            <div class="hero-metric-card">
                <div class="hero-metric-header">
                    <span class="hero-metric-icon">ğŸŒ¡ï¸</span>
                    <div class="hero-metric-info">
                        <p class="hero-metric-label">Suhu Tubuh</p>
                        <p class="hero-metric-time" id="vitals-last-update">Data terbaru</p>
                    </div>
                </div>
                <div class="hero-metric-value-wrapper">
                    <span class="hero-metric-value" id="suhu-tubuh-value">--</span>
                    <span class="hero-metric-unit">Â°C</span>
                </div>
                <div class="hero-metric-status">
                    <span class="status-badge-hero" id="suhu-tubuh-status">--</span>
                </div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             VITAL SIGNS GRID - MODERN LAYOUT
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="vitals-section">
            <div class="section-header-modern">
                <h2 class="section-title-modern">Vital Signs</h2>
                <span class="section-subtitle">Monitoring real-time</span>
            </div>

            <div class="vitals-grid-modern">
                <!-- Heart Rate Card -->
                <div class="vital-card vital-card-red">
                    <div class="vital-card-header">
                        <span class="vital-icon">â¤ï¸</span>
                        <div class="vital-badge">Live</div>
                    </div>
                    <div class="vital-value-wrapper">
                        <span class="vital-value" id="home-heartrate">--</span>
                        <span class="vital-unit">BPM</span>
                    </div>
                    <p class="vital-label">Heart Rate</p>
                    <div class="vital-mini-chart"></div>
                </div>

                <!-- SpO2 Card -->
                <div class="vital-card vital-card-blue">
                    <div class="vital-card-header">
                        <span class="vital-icon">ğŸ’§</span>
                        <div class="vital-badge">Live</div>
                    </div>
                    <div class="vital-value-wrapper">
                        <span class="vital-value" id="home-spo2">--</span>
                        <span class="vital-unit">%</span>
                    </div>
                    <p class="vital-label">SpO2 Level</p>
                    <div class="vital-mini-chart"></div>
                </div>

                <!-- Body Temperature Card -->
                <div class="vital-card vital-card-orange">
                    <div class="vital-card-header">
                        <span class="vital-icon">ğŸŒ¡ï¸</span>
                        <div class="vital-badge">Live</div>
                    </div>
                    <div class="vital-value-wrapper">
                        <span class="vital-value" id="home-temperature">--</span>
                        <span class="vital-unit">Â°C</span>
                    </div>
                    <p class="vital-label">Body Temp</p>
                    <div class="vital-mini-chart"></div>
                </div>

                <!-- Ambient Temperature Card -->
                <div class="vital-card vital-card-green">
                    <div class="vital-card-header">
                        <span class="vital-icon">ğŸ </span>
                        <div class="vital-badge">Live</div>
                    </div>
                    <div class="vital-value-wrapper">
                        <span class="vital-value" id="home-ambient">--</span>
                        <span class="vital-unit">Â°C</span>
                    </div>
                    <p class="vital-label">Room Temp</p>
                    <div class="vital-mini-chart"></div>
                </div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             DEVICE STATUS - MODERN CARD
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="device-status-section">
            <div class="device-status-card">
                <div class="device-status-header">
                    <div class="device-status-icon">
                        <span class="material-symbols-outlined">bluetooth</span>
                    </div>
                    <div class="device-status-info">
                        <p class="device-status-label">Connected Device</p>
                        <h3 class="device-status-name" id="home-device-name">Mencari perangkat...</h3>
                    </div>
                    <span id="home-device-status" class="status-indicator status-offline">
                        <span class="status-dot"></span>
                        <span class="status-text">Offline</span>
                    </span>
                </div>
                <div class="device-status-details">
                    <div class="device-detail-item">
                        <span class="device-detail-label">Device ID</span>
                        <span class="device-detail-value" id="home-device-id">-</span>
                    </div>
                    <div class="device-detail-item">
                        <span class="device-detail-label">Connection</span>
                        <span class="device-detail-value">Bluetooth 5.0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-header" style="margin-top: 20px;">
            <h2 class="section-title">Grafik Kesehatan</h2>
        </div>

        <section class="chart-card card">
            <p class="chart-title">Riwayat Detak Jantung (10 data terakhir)</p>
            <canvas id="bpmChart"></canvas>
        </section>

        <section class="chart-card card">
            <p class="chart-title">Riwayat Suhu Tubuh (10 data terakhir)</p>
            <canvas id="tempChart"></canvas>
        </section>

        <section class="chart-card card">
            <p class="chart-title">Riwayat Suhu Ruangan (10 data terakhir)</p>
            <canvas id="ambientChart"></canvas>
        </section>

        <section class="health-summary-card card">
            <h2 class="chart-title" style="text-align: center;">Rangkuman Kesehatan</h2>

            <div id="summary-status-container" class="report-status-container">
                <p>Status Keseluruhan:</p>
                <h3 id="summary-status-text" class="status-bugar">Memuat...</h3>
            </div>

            <div class="report-details">
                <h4>Detail Laporan:</h4>
                <ul id="summary-detail-list" class="report-details-list">
                    <li>Memuat data sensor...</li>
                </ul>
            </div>
        </section>

        <!-- Modal -->
        <div id="report-modal" class="modal">
          <div class="modal-content">
            <span class="close-btn" id="modal-close-btn">&times;</span>
            <h2>Rangkuman Kesehatan</h2>
            <div class="report-status-container">
              <p>Status Keseluruhan:</p>
              <h3 id="report-status" class="status-bugar">BUGAR</h3>
            </div>
            <div class="report-details">
              <h4>Detail Laporan:</h4>
              <ul id="report-detail-list"></ul>
            </div>
            <div class="report-recommendations">
              <h4>Rekomendasi (Treatment):</h4>
              <ul id="report-list"></ul>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: NEWS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-news" class="page container">
        <div class="news-banner">
          <img src="https://picsum.photos/600/300?grayscale" alt="Hot News" />
          <div class="news-banner-overlay">
            <h2>Trending Today</h2>
            <p>Update terbaru dunia health & AI</p>
          </div>
        </div>

        <h2 class="page-title">Latest News</h2>

        <div class="news-filter">
          <span class="chip active" onclick="filterNews('all', this)">All</span>
          <span class="chip" onclick="filterNews('Community', this)">Community</span>
          <span class="chip" onclick="filterNews('Health', this)">Health</span>
          <span class="chip" onclick="filterNews('Technology', this)">Technology</span>
        </div>

        <div class="news-list-container" id="news-container">
          <p class="loading-text">Memuat berita terbaru...</p>
        </div>

        <!-- News Modal -->
        <div id="newsModal" class="modal-overlay" onclick="closeModal(event)" style="display: none;">
          <div class="modal-content">
            <div class="modal-header">
              <button class="btn-back" onclick="closeModalDirect()">
                <span class="material-symbols-outlined">arrow_back</span>
              </button>
            </div>
            <img id="modalImg" src="" class="modal-img" onerror="this.src='https://picsum.photos/600/400?blur'">
            <div class="modal-body">
              <h2 id="modalTitle" class="modal-title">Loading...</h2>
              <div class="modal-meta">
                <span id="modalCategory" class="modal-category-badge">CATEGORY</span>
                <span class="modal-time">
                  <span class="material-symbols-outlined" style="font-size:16px;">schedule</span>
                  <span id="modalDate">Baru saja</span>
                </span>
              </div>
              <p id="modalDesc" class="modal-desc">Memuat konten...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: PERANGKAT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-perangkat" class="page container">
        <!-- Device Hero -->
        <div class="device-hero">
          <img src="https://cdn-icons-png.flaticon.com/512/2917/2917995.png" alt="Smart Device">
          <h2 class="device-section-title" style="margin-top: 15px;">Perangkat Saya</h2>
          <p style="color: #666; font-size: 0.95em;">Kelola koneksi perangkat kesehatan Anda</p>
        </div>

        <!-- Connected Devices Section -->
        <div id="connected-devices-container">
          <!-- Will be populated by JavaScript if device is connected -->
        </div>

        <!-- No Devices State -->
        <div class="no-devices" id="no-devices-state">
          <span class="material-symbols-outlined" style="font-size: 64px; color: #ccc; margin-bottom: 15px;">devices_off</span>
          <h3 style="color: #333; margin-bottom: 8px;">Belum Ada Perangkat</h3>
          <p style="color: #777; font-size: 0.9em; margin-bottom: 25px;">Hubungkan perangkat kesehatan Anda untuk memulai monitoring</p>

          <button class="add-device-btn" id="btn-connect-device" style="color: white; border: none; padding: 14px 28px; border-radius: 16px; font-size: 1em; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; margin: 0 auto;">
            <span class="material-symbols-outlined">add_circle</span>
            Hubungkan Perangkat
          </button>
        </div>

        <!-- Info Cards -->
        <div style="margin-top: 30px;">
          <div class="card" style="padding: 18px; margin-bottom: 15px; background: #e8f5e9; border-left: 4px solid #27AE60;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span class="material-symbols-outlined" style="font-size: 32px; color: #27AE60;">bluetooth</span>
              <div>
                <h4 style="margin: 0 0 4px 0; font-size: 1em; color: #333;">Koneksi Bluetooth</h4>
                <p style="margin: 0; font-size: 0.85em; color: #666;">Pastikan Bluetooth aktif untuk menghubungkan perangkat</p>
              </div>
            </div>
          </div>

          <div class="card" style="padding: 18px; background: #fff3e0; border-left: 4px solid #F39C12;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span class="material-symbols-outlined" style="font-size: 32px; color: #F39C12;">health_and_safety</span>
              <div>
                <h4 style="margin: 0 0 4px 0; font-size: 1em; color: #333;">Monitoring Real-time</h4>
                <p style="margin: 0; font-size: 0.85em; color: #666;">Data kesehatan akan ter-update secara otomatis</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- BLE Connection Modal -->
      <div id="ble-modal" class="ble-modal">
        <div class="ble-modal-content">
          <div class="ble-modal-header">
            <h3 class="ble-modal-title">Hubungkan Perangkat</h3>
            <button class="ble-close-btn" id="ble-close-btn">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>

          <div class="ble-input-group">
            <label class="ble-input-label">Nama Perangkat</label>
            <input type="text" class="ble-input" id="ble-device-name" placeholder="Contoh: ESP32-C3, CareRing Device" value="ESP32-C3">
          </div>

          <div class="ble-progress" id="ble-progress">
            <div class="ble-progress-bar"></div>
          </div>

          <button class="ble-connect-btn" id="ble-connect-btn">
            <span class="material-symbols-outlined">bluetooth_searching</span>
            Cari & Hubungkan
          </button>

          <div class="ble-message" id="ble-message"></div>

          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
            <p style="font-size: 0.85em; color: #666; margin: 0;">
              <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">info</span>
              Pastikan perangkat dalam mode pairing dan Bluetooth aktif
            </p>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: AI CHAT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-ai-chat" class="page container">
        <div class="ai-hero">
          <div class="ai-avatar">
            <img src="https://i.ibb.co/KG3y4Lp/ai-avatar.png" alt="AI Assistant" onerror="this.parentElement.innerHTML='ğŸ¤–'" />
          </div>
          <h2>CareRing AI Assistant</h2>
        </div>

        <div class="chat-container">
          <div id="chat-window" class="chat-window">
            <div class="message ai-message">
              <p>Halo! Saya adalah Bot CARERING. Tanyakan saya tentang data kesehatan Anda.</p>
            </div>
          </div>

          <div id="suggested-questions" class="suggested-questions">
            <button class="suggest-btn">Bagaimana suhu tubuh saya?</button>
            <button class="suggest-btn">Detak jantung saya normal?</button>
            <button class="suggest-btn">Apa itu hipotermia?</button>
          </div>

          <form id="chat-form" class="chat-form">
            <input type="text" id="chat-input" placeholder="Ketik pesan Anda..." required>
            <button type="submit" id="send-btn">
              <span class="material-symbols-outlined">send</span>
            </button>
          </form>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: FORUM
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-forum" class="page container">
        <div class="page-header-container" style="background: #4a90e2; padding: 28px 20px; margin: -10px -10px 25px -10px; border-radius: 0 0 25px 25px; color: white; box-shadow: 0 8px 16px rgba(46, 95, 153, 0.3);">
          <h2 class="page-title" style="font-size: 22px; font-weight: 800; margin: 0;">Forum Diskusi</h2>
        </div>

        <div class="forum-list-container">
          <a href="#" class="list-item-card" style="display: flex; align-items: flex-start; padding: 18px; margin-bottom: 14px; border-radius: 16px; text-decoration: none; color: #222;">
            <div class="list-item-icon" style="width: 55px; height: 55px; border-radius: 14px; display: flex; justify-content: center; align-items: center; font-size: 28px; margin-right: 15px; background: #e0e5ec; color: #4a90e2; box-shadow: 4px 4px 8px rgba(163, 177, 198, 0.6), -4px -4px 8px rgba(255, 255, 255, 0.5);">
              <span class="material-symbols-outlined">question_answer</span>
            </div>
            <div class="list-item-content">
              <h3 style="margin: 0; font-size: 16.5px; font-weight: 600;">Apa itu Hipotermia?</h3>
              <p class="list-item-meta" style="font-size: 13px; color: #666; margin-top: 6px;">Oleh Erico Varel â€¢ 2 Balasan</p>
            </div>
            <span class="material-symbols-outlined list-item-chevron" style="margin-left: auto; color: #ccc; font-size: 28px;">chevron_right</span>
          </a>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: PROFIL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-profil" class="page container">
        <h2 class="profile-page-title" style="text-align: center; margin-bottom: 20px; font-size: 1.8em; color: #333;">Profil</h2>

        <div class="profile-card" style="padding: 30px 20px; margin: 20px auto; text-align: center; max-width: 350px;">
          <div class="profile-avatar-large" style="width: 80px; height: 80px; border-radius: 50%; background: #e0e5ec; color: #4a90e2; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto; font-size: 40px; position: relative; overflow: hidden; box-shadow: 6px 6px 12px rgba(163, 177, 198, 0.6), -6px -6px 12px rgba(255, 255, 255, 0.5);">
            <img id="profil-img" src="" alt="Foto Profil" style="width: 100%; height: 100%; object-fit: cover; display: none;" onload="this.style.display='block'; document.getElementById('profil-default-icon').style.display='none';">
            <span class="material-symbols-outlined" id="profil-default-icon">person</span>
          </div>

          <h3 id="profil-nama" style="font-size: 1.5em; margin-bottom: 5px; color: #333;">Memuat...</h3>
          <p id="profil-email" style="font-size: 0.9em; color: #777; margin-bottom: 25px;">Memuat...</p>

          <div class="profile-detail-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; font-size: 0.95em; color: #555;">
            <span class="profile-detail-label" style="font-weight: 500; color: #333;">Perangkat Terhubung:</span>
            <span class="profile-detail-value">
              <span id="profile-device-lastseen" class="status-loading">ESP32-C3</span>
            </span>
          </div>
          <div class="profile-detail-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; font-size: 0.95em; color: #555;">
            <span class="profile-detail-label" style="font-weight: 500; color: #333;">Member Sejak:</span>
            <span class="profile-detail-value">2025</span>
          </div>
          <div class="profile-detail-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; margin-bottom: 20px; font-size: 0.95em; color: #555;">
            <span class="profile-detail-label" style="font-weight: 500; color: #333;">Status Akun:</span>
            <span class="profile-detail-value" style="color: green; font-weight:600;">Aktif</span>
          </div>
        </div>

        <a href="#" class="logout-btn-card" id="btn-logout" style="display: flex; align-items: center; padding: 15px 20px; margin: 30px auto; max-width: 350px; cursor: pointer; text-decoration: none; color: inherit;">
          <div class="list-item-icon" style="background: #e0e5ec; color: #E74C3C; margin-right: 15px; width: 55px; height: 55px; border-radius: 14px; display: flex; justify-content: center; align-items: center; box-shadow: 4px 4px 8px rgba(163, 177, 198, 0.6), -4px -4px 8px rgba(255, 255, 255, 0.5);">
            <span class="material-symbols-outlined">logout</span>
          </div>
          <h3 style="margin: 0; font-size: 1.1em; color: #E74C3C; flex-grow: 1; text-align: left;">Keluar</h3>
          <span class="material-symbols-outlined list-item-chevron" style="color: #E74C3C;">chevron_right</span>
        </a>
      </div>

    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         BOTTOM NAVIGATION (Persisten - Always visible)
         Swipe/scroll kanan-kiri untuk melihat semua menu
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="bottom-nav" id="bottom-nav">
      <div class="nav-item active" data-navigate="home">
        <div class="nav-icon"><span class="material-symbols-outlined">home</span></div>
        <div class="nav-label">Home</div>
      </div>
      <div class="nav-item" data-navigate="news">
        <div class="nav-icon"><span class="material-symbols-outlined">newspaper</span></div>
        <div class="nav-label">News</div>
      </div>
      <div class="nav-item" data-navigate="perangkat">
        <div class="nav-icon"><span class="material-symbols-outlined">devices</span></div>
        <div class="nav-label">Perangkat</div>
      </div>
      <div class="nav-item" data-navigate="ai-chat">
        <div class="nav-icon"><span class="material-symbols-outlined">smart_toy</span></div>
        <div class="nav-label">AI Chat</div>
      </div>
      <div class="nav-item" data-navigate="forum">
        <div class="nav-icon"><span class="material-symbols-outlined">forum</span></div>
        <div class="nav-label">Forum</div>
      </div>
      <div class="nav-item" data-navigate="profil">
        <div class="nav-icon"><span class="material-symbols-outlined">person</span></div>
        <div class="nav-label">Profil</div>
      </div>
    </div>

    <!-- Scroll hint indicator (auto-hide setelah 3 detik) -->
    <script>
      // Add subtle scroll hint on first load
      (function() {
        const bottomNav = document.getElementById('bottom-nav');
        const scrollHintShown = sessionStorage.getItem('navScrollHintShown');

        if (!scrollHintShown && bottomNav) {
          // Show hint by slightly scrolling right then back
          setTimeout(() => {
            bottomNav.scrollTo({ left: 60, behavior: 'smooth' });
            setTimeout(() => {
              bottomNav.scrollTo({ left: 0, behavior: 'smooth' });
            }, 800);
          }, 1000);

          sessionStorage.setItem('navScrollHintShown', 'true');
        }

        // Hide fade indicators when at edges
        function updateFadeIndicators() {
          const scrollLeft = bottomNav.scrollLeft;
          const maxScroll = bottomNav.scrollWidth - bottomNav.clientWidth;

          // You can add logic here to show/hide fade indicators dynamically
          // For now, they're always visible unless on large screens
        }

        if (bottomNav) {
          bottomNav.addEventListener('scroll', updateFadeIndicators);
          updateFadeIndicators();
        }
      })();
    </script>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FIREBASE & SCRIPTS - Load sekali, persist selamanya!
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script src="/script.js"></script>
  <script src="/auth-guard.js"></script>
  <script src="/ble-handler.js"></script>
  <script src="/ble-indicator.js"></script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SPA ROUTER - Handle navigation tanpa page reload!
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    SPA ROUTER SYSTEM
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    (function() {
      'use strict';

      console.log('ğŸš€ SPA Router initialized');
      console.log('âœ… BLE Connection will persist across navigation!');

      // Current page tracking
      let currentPage = 'home';

      /**
       * Navigate to a page
       */
      function navigateToPage(pageName) {
        console.log(`ğŸ“„ Navigating to: ${pageName}`);

        // Hide all pages
        document.querySelectorAll('.page').forEach(page => {
          page.classList.remove('active');
        });

        // Show target page
        const targetPage = document.getElementById(`page-${pageName}`);
        if (targetPage) {
          targetPage.classList.add('active');
          currentPage = pageName;

          // Update navigation active state
          updateNavigation(pageName);

          // Update URL hash (without reload!)
          window.location.hash = pageName;

          // Scroll to top
          window.scrollTo(0, 0);

          // Page-specific initialization
          initializePage(pageName);
        } else {
          console.error(`âŒ Page not found: ${pageName}`);
        }
      }

      /**
       * Update navigation bar active state
       */
      function updateNavigation(pageName) {
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
        });

        const activeNav = document.querySelector(`.nav-item[data-navigate="${pageName}"]`);
        if (activeNav) {
          activeNav.classList.add('active');

          // Move sliding indicator to active item
          moveIndicator(activeNav);
        }
      }

      /**
       * Move sliding indicator blob to active nav item
       */
      function moveIndicator(activeElement) {
        const bottomNav = document.getElementById('bottom-nav');
        if (!bottomNav || !activeElement) return;

        // Add ready class to show indicator
        bottomNav.classList.add('indicator-ready');

        // Calculate position
        const navRect = bottomNav.getBoundingClientRect();
        const itemRect = activeElement.getBoundingClientRect();
        const offsetLeft = itemRect.left - navRect.left + bottomNav.scrollLeft;

        // Apply transform to move indicator
        bottomNav.style.setProperty('--indicator-left', `${offsetLeft}px`);
        bottomNav.style.setProperty('--indicator-width', `${itemRect.width}px`);
      }

      /**
       * Initialize page-specific functionality
       */
      function initializePage(pageName) {
        console.log(`ğŸ”§ Initializing page: ${pageName}`);

        switch(pageName) {
          case 'home':
            // Home page already initialized by script.js
            break;

          case 'news':
            // Trigger news loading if needed
            if (typeof loadNews === 'function') {
              loadNews();
            }
            break;

          case 'perangkat':
            // Perangkat page specific init
            initPerangkatPage();
            break;

          case 'ai-chat':
            // AI Chat init
            break;

          case 'forum':
            // Forum init
            break;

          case 'profil':
            // Profile page init (handled by script.js)
            break;
        }
      }

      /**
       * Initialize Perangkat page
       */
      function initPerangkatPage() {
        console.log('ğŸ”§ Initializing Perangkat page...');

        // Get modal elements
        const modal = document.getElementById('ble-modal');
        const btnConnect = document.getElementById('btn-connect-device');
        const btnClose = document.getElementById('ble-close-btn');
        const btnBLEConnect = document.getElementById('ble-connect-btn');
        const bleProgress = document.getElementById('ble-progress');
        const bleMessage = document.getElementById('ble-message');
        const deviceNameInput = document.getElementById('ble-device-name');

        // Open modal
        if (btnConnect) {
          btnConnect.addEventListener('click', () => {
            modal.classList.add('show');
            bleMessage.classList.remove('show');
          });
        }

        // Close modal
        if (btnClose) {
          btnClose.addEventListener('click', () => {
            modal.classList.remove('show');
          });
        }

        // Close modal on outside click
        if (modal) {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.classList.remove('show');
            }
          });
        }

        // Connect to device
        if (btnBLEConnect) {
          btnBLEConnect.addEventListener('click', async () => {
            try {
              // Show progress
              bleProgress.classList.add('show');
              bleMessage.classList.remove('show');
              btnBLEConnect.disabled = true;
              btnBLEConnect.innerHTML = '<span class="material-symbols-outlined">hourglass_empty</span> Menghubungkan...';

              // Update device name prefix if needed
              const deviceName = deviceNameInput.value.trim();
              if (deviceName) {
                console.log('ğŸ” Mencari perangkat:', deviceName);
              }

              // Call BLE connect from ble-handler.js
              if (window.BLEHandler && window.BLEHandler.connect) {
                await window.BLEHandler.connect();

                // Success!
                bleProgress.classList.remove('show');
                bleMessage.className = 'ble-message show success';
                bleMessage.textContent = 'âœ… Berhasil terhubung! Data akan mulai disinkronkan.';
                btnBLEConnect.innerHTML = '<span class="material-symbols-outlined">check_circle</span> Terhubung';

                // Close modal after 2 seconds
                setTimeout(() => {
                  modal.classList.remove('show');
                  updateDeviceUI();
                }, 2000);

              } else {
                throw new Error('BLE Handler belum dimuat');
              }

            } catch (error) {
              console.error('âŒ Koneksi gagal:', error);

              bleProgress.classList.remove('show');
              bleMessage.className = 'ble-message show error';
              bleMessage.textContent = error.message || 'Gagal menghubungkan. Pastikan Bluetooth aktif dan perangkat dalam mode pairing.';
              btnBLEConnect.disabled = false;
              btnBLEConnect.innerHTML = '<span class="material-symbols-outlined">bluetooth_searching</span> Coba Lagi';
            }
          });
        }

        // Update UI based on connection status
        updateDeviceUI();



        

        // Listen for BLE events
        window.addEventListener('bleConnected', updateDeviceUI);
        window.addEventListener('bleDisconnected', updateDeviceUI);
      }

      /**
       * Update device UI based on connection status
       */
      function updateDeviceUI() {
        const connectedContainer = document.getElementById('connected-devices-container');
        const noDevicesState = document.getElementById('no-devices-state');

        if (!connectedContainer || !noDevicesState) return;

        // Check if device is connected
        if (window.BLEHandler && window.BLEHandler.isConnected && window.BLEHandler.isConnected()) {
          const deviceInfo = window.BLEHandler.getDeviceInfo();

          // Hide no devices state
          noDevicesState.style.display = 'none';

          // Show connected device
          connectedContainer.innerHTML = `
            <div class="device-card">
              <div class="device-name">${deviceInfo.name || 'CareRing Device'}</div>
              <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle; color: #27AE60;">check_circle</span>
                Terhubung
              </div>
              <div style="font-size: 0.8em; color: #999; margin-top: 8px;">
                ID: ${deviceInfo.id || '-'}
              </div>

              <div class="device-actions">
                <div class="action-btn" onclick="console.log('Sync clicked')">
                  <span class="material-symbols-outlined">sync</span>
                  <div>
                    <div style="font-weight: 600;">Sinkronisasi Manual</div>
                    <div style="font-size: 0.85em; color: #666;">Update data sekarang</div>
                  </div>
                </div>

                <div class="action-btn action-btn-disconnect" onclick="disconnectDevice()">
                  <span class="material-symbols-outlined">link_off</span>
                  <div>
                    <div style="font-weight: 600; color: #E74C3C;">Putuskan Koneksi</div>
                    <div style="font-size: 0.85em; color: #999;">Hentikan monitoring</div>
                  </div>
                </div>
              </div>
            </div>
          `;
        } else {
          // Show no devices state
          noDevicesState.style.display = 'block';
          connectedContainer.innerHTML = '';
        }
      }

      /**
       * Disconnect device
       */
      function disconnectDevice() {
        if (confirm('Apakah Anda yakin ingin memutuskan koneksi dengan perangkat?')) {
          if (window.BLEHandler && window.BLEHandler.disconnect) {
            window.BLEHandler.disconnect();
            updateDeviceUI();
          }
        }
      }

      // Make functions globally accessible
      window.disconnectDevice = disconnectDevice;

      /**
       * Create ripple effect on navigation item
       */
      function createRipple(event, element) {
        const ripple = document.createElement('span');
        ripple.style.cssText = `
          position: absolute;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.6);
          width: 100px;
          height: 100px;
          margin-top: -50px;
          margin-left: -50px;
          top: ${event.clientY - element.getBoundingClientRect().top}px;
          left: ${event.clientX - element.getBoundingClientRect().left}px;
          animation: ripple 0.6s ease-out;
          pointer-events: none;
        `;

        element.appendChild(ripple);

        setTimeout(() => {
          ripple.remove();
        }, 600);

        // Add particle burst effect
        createParticleBurst(event, element);
      }

      /**
       * Create particle burst effect on click
       */
      function createParticleBurst(event, element) {
        const particles = ['âœ¨', 'â­', 'ğŸ’«', 'ğŸŒŸ'];
        const particleCount = 6;

        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('span');
          const randomParticle = particles[Math.floor(Math.random() * particles.length)];
          const angle = (360 / particleCount) * i;

          particle.textContent = randomParticle;
          particle.style.cssText = `
            position: absolute;
            top: ${event.clientY - element.getBoundingClientRect().top}px;
            left: ${event.clientX - element.getBoundingClientRect().left}px;
            font-size: 12px;
            pointer-events: none;
            animation: particleBurst 0.8s ease-out forwards;
            --angle: ${angle}deg;
            z-index: 1000;
          `;

          element.appendChild(particle);

          setTimeout(() => {
            particle.remove();
          }, 800);
        }
      }

      /**
       * Setup navigation listeners
       */
      function setupNavigation() {
        // Bottom navigation clicks
        document.querySelectorAll('[data-navigate]').forEach(element => {
          element.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();

            // Create ripple effect
            if (element.classList.contains('nav-item')) {
              createRipple(e, element);

              // Haptic feedback for mobile devices
              if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(10); // 10ms vibration
              }
            }

            const pageName = element.getAttribute('data-navigate');
            navigateToPage(pageName);
          });
        });

        // Handle browser back/forward
        window.addEventListener('hashchange', () => {
          const hash = window.location.hash.slice(1);
          if (hash && hash !== currentPage) {
            navigateToPage(hash);
          }
        });

        // Handle initial hash
        const initialHash = window.location.hash.slice(1);
        if (initialHash) {
          navigateToPage(initialHash);
        }
      }

      // Initialize router when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          setupNavigation();
          initializeIndicator();
        });
      } else {
        setupNavigation();
        initializeIndicator();
      }

      /**
       * Initialize sliding indicator on page load
       */
      function initializeIndicator() {
        setTimeout(() => {
          const activeNav = document.querySelector('.nav-item.active');
          if (activeNav) {
            moveIndicator(activeNav);
          }
        }, 500); // Delay to ensure nav items are rendered
      }

      // Expose navigateToPage globally
      window.navigateToPage = navigateToPage;

      console.log('âœ… SPA Router ready!');
    })();
  </script>

  <!-- Service Worker - DISABLED untuk debugging -->
  <script>
    // Service Worker temporarily disabled to fix loading issues
    console.log('â„¹ï¸ Service Worker disabled for debugging');

    // if ('serviceWorker' in navigator) {
    //   window.addEventListener('load', () => {
    //     navigator.serviceWorker.register('/sw.js')
    //       .then(registration => {
    //         console.log('ServiceWorker registration successful: ', registration.scope);
    //       })
    //       .catch(error => {
    //         console.log('ServiceWorker registration failed: ', error);
    //       });
    //   });
    // }
  </script>

</body>
</html>
