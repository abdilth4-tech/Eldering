<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CARERING Healthcare - SPA</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007BFF">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SPA CORE STYLES - Hide/Show Pages
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Prevent flash of content */
    .mobile-wrapper {
      min-height: 100vh;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PERANGKAT PAGE STYLES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .device-hero {
      text-align: center;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .device-hero img {
      width: 140px;
      filter: drop-shadow(0 12px 20px rgba(0,0,0,0.15));
      animation: float 4s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }

    .device-section-title {
      font-size: 1.6em;
      font-weight: 700;
      text-align: center;
      margin-bottom: 15px;
    }

    .device-card {
      background: #fff;
      padding: 22px;
      border-radius: 22px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.08);
      animation: fadeInUp .4s ease;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .device-name {
      font-size: 1.4em;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .battery-bar {
      height: 8px;
      background: #e7e7e7;
      border-radius: 10px;
      margin-top: 6px;
      overflow: hidden;
    }

    .battery-fill {
      height: 8px;
      width: 0%;
      background: linear-gradient(90deg, #00c853, #4aff7a);
      border-radius: 10px;
      transition: width .5s ease;
    }

    .device-actions {
      margin-top: 20px;
      display: grid;
      gap: 12px;
    }

    .action-btn {
      background: #f5f8ff;
      padding: 14px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      transition: 0.2s;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      background: #eef4ff;
    }

    .action-btn span {
      font-size: 26px;
      color: #007BFF;
    }

    .action-btn-disconnect {
      background: #fff5f5 !important;
    }

    .action-btn-disconnect:hover {
      background: #ffe1e1 !important;
    }

    .action-btn-disconnect span {
      color: #E74C3C !important;
    }

    .no-devices {
      text-align: center;
      padding: 28px;
      background: white;
      border-radius: 20px;
      margin-top: 20px;
      box-shadow: 0 8px 26px rgba(0,0,0,0.08);
    }

    .add-device-btn {
      transition: all 0.2s ease;
    }

    .add-device-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,123,255,0.4) !important;
    }

    /* BLE Modal */
    .ble-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .ble-modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ble-modal-content {
      background: white;
      border-radius: 24px;
      padding: 28px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
      position: relative;
    }

    .ble-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .ble-modal-title {
      font-size: 1.5em;
      font-weight: 700;
      color: #333;
    }

    .ble-close-btn {
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: #999;
      padding: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: 0.2s;
    }

    .ble-close-btn:hover {
      background: #f5f5f5;
      color: #333;
    }

    .ble-input-group {
      margin-bottom: 20px;
    }

    .ble-input-label {
      display: block;
      font-size: 0.9em;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }

    .ble-input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 1em;
      transition: 0.2s;
      box-sizing: border-box;
    }

    .ble-input:focus {
      outline: none;
      border-color: #007BFF;
    }

    .ble-progress {
      display: none;
      width: 100%;
      height: 4px;
      background: #e0e0e0;
      border-radius: 2px;
      overflow: hidden;
      margin: 20px 0;
    }

    .ble-progress.show {
      display: block;
    }

    .ble-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #007BFF, #00a6ff);
      width: 0%;
      animation: progress 1.5s ease-in-out infinite;
    }

    @keyframes progress {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }

    .ble-connect-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #007BFF, #0056b3);
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: 0.2s;
      box-shadow: 0 4px 15px rgba(0,123,255,0.3);
    }

    .ble-connect-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,123,255,0.4);
    }

    .ble-connect-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .ble-message {
      margin-top: 16px;
      padding: 12px;
      border-radius: 12px;
      font-size: 0.9em;
      display: none;
    }

    .ble-message.show {
      display: block;
    }

    .ble-message.success {
      background: #d1ffe7;
      color: #067a3e;
    }

    .ble-message.error {
      background: #ffe1e1;
      color: #b50000;
    }

    .ble-message.info {
      background: #e3f2fd;
      color: #1565c0;
    }
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AI CHAT STYLES (MODERN)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .chat-window {
      /* Hapus inline style di HTML agar ini bekerja */
      background-color: #f5f7fb !important;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      font-size: 0.95em;
      line-height: 1.5;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      animation: popIn 0.3s ease;
    }

    .ai-message {
      align-self: flex-start;
      background-color: #ffffff !important;
      color: #333 !important;
      border-bottom-left-radius: 4px;
      border: 1px solid #e0e0e0;
    }
    
    /* Label Nama Bot */
    .ai-message::before {
      content: "ğŸ¤– CareRing Bot";
      display: block;
      font-size: 0.75em;
      color: #007bff;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .user-message {
      align-self: flex-end;
      background: linear-gradient(135deg, #007BFF, #0056b3) !important;
      color: white !important;
      border: none !important;
      border-bottom-right-radius: 4px;
    }

    @keyframes popIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
  </style>
</head>
<body>

  <div class="mobile-wrapper">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SHARED HEADER (Persisten di semua pages)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="app-header">
        <div class="logo" style="cursor: pointer;" data-navigate="home">
            <span class="logo-care">Care</span><span class="logo-ring">Ring</span>
        </div>

        <div class="profile-icon" data-navigate="profil">
            <img id="nav-user-photo" src="" style="width: 32px; height: 32px; border-radius: 50%; display: none; object-fit: cover;">
            <span class="material-symbols-outlined" style="font-size: 32px;">person</span>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE CONTAINER - Semua halaman ada di sini
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main id="page-container">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: HOME / DASHBOARD
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-home" class="page active container">

        <div class="home-greeting" id="user-greeting">Memuat...</div>
        <div class="home-subgreeting">Temukan data kesehatan Anda.</div>

        <div class="search-bar">
            <span class="search-icon"><span class="material-symbols-outlined">search</span></span>
            <input type="text" placeholder="Cari data, berita, atau forum...">
        </div>

        <div class="section-header">
            <h2 class="section-title">Categories</h2>
        </div>
        <div class="categories-scroll">
            <div class="category-item" data-navigate="perangkat">
                <span class="category-icon"><span class="material-symbols-outlined">devices</span></span>
                <span class="category-label">Device</span>
            </div>
            <div class="category-item" data-navigate="ai-chat">
                <span class="category-icon"><span class="material-symbols-outlined">smart_toy</span></span>
                <span class="category-label">AI Chat</span>
            </div>
            <div class="category-item" data-navigate="forum">
                <span class="category-icon"><span class="material-symbols-outlined">forum</span></span>
                <span class="category-label">Forum</span>
            </div>
            <div class="category-item" data-navigate="news">
                <span class="category-icon"><span class="material-symbols-outlined">newspaper</span></span>
                <span class="category-label">News</span>
            </div>
        </div>

        <div class="section-header" style="margin-top: 20px;">
            <h2 class="section-title">Status Utama</h2>
        </div>

        <div class="temp-card card">
            <div class="temp-label">Suhu Tubuh</div>
            <div class="temp-value"><span id="suhu-tubuh-value">--</span>Â°C</div>
            <span class="temp-status" id="suhu-tubuh-status">--</span>
        </div>

        <div class="section-header" style="margin-top: 20px;">
            <h2 class="section-title">Semua Vitals</h2>
            <span class="see-all" id="vitals-last-update">Data Terbaru</span>
        </div>

        <!-- Real-time Sensor Data Cards -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
            <!-- Heart Rate Card -->
            <div class="card" style="padding: 16px; text-align: center; background: linear-gradient(135deg, #FFE5E5, #FFF); border-left: 4px solid #E74C3C;">
                <div style="font-size: 0.85em; color: #666; margin-bottom: 8px;">â¤ï¸ Heart Rate</div>
                <div style="font-size: 2em; font-weight: 700; color: #E74C3C;" id="home-heartrate">--</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 4px;">BPM</div>
            </div>

            <!-- SpO2 Card -->
            <div class="card" style="padding: 16px; text-align: center; background: linear-gradient(135deg, #E5F5FF, #FFF); border-left: 4px solid #3498DB;">
                <div style="font-size: 0.85em; color: #666; margin-bottom: 8px;">ğŸ’§ SpO2</div>
                <div style="font-size: 2em; font-weight: 700; color: #3498DB;" id="home-spo2">--</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 4px;">%</div>
            </div>

            <!-- Body Temperature Card -->
            <div class="card" style="padding: 16px; text-align: center; background: linear-gradient(135deg, #FFF5E5, #FFF); border-left: 4px solid #F39C12;">
                <div style="font-size: 0.85em; color: #666; margin-bottom: 8px;">ğŸŒ¡ï¸ Suhu Tubuh</div>
                <div style="font-size: 2em; font-weight: 700; color: #F39C12;" id="home-temperature">--</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 4px;">Â°C</div>
            </div>

            <!-- Ambient Temperature Card -->
            <div class="card" style="padding: 16px; text-align: center; background: linear-gradient(135deg, #E5FFE5, #FFF); border-left: 4px solid #27AE60;">
                <div style="font-size: 0.85em; color: #666; margin-bottom: 8px;">ğŸ  Suhu Ruangan</div>
                <div style="font-size: 2em; font-weight: 700; color: #27AE60;" id="home-ambient">--</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 4px;">Â°C</div>
            </div>
        </div>

        <!-- Device Status Card -->
        <div class="card" style="padding: 16px; margin-bottom: 20px; background: linear-gradient(135deg, #F0F8FF, #FFF); border-left: 4px solid #007BFF;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 6px;">ğŸ“¡ Device Status</div>
                    <div style="font-size: 1.1em; font-weight: 600; color: #333;" id="home-device-name">Mencari perangkat...</div>
                </div>
                <div>
                    <span id="home-device-status" class="status-badge status-offline" style="font-size: 0.85em;">Offline</span>
                </div>
            </div>
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; font-size: 0.8em; color: #999;">
                <span>Device ID: </span><span id="home-device-id">-</span>
            </div>
        </div>

        <div class="section-header" style="margin-top: 20px;">
            <h2 class="section-title">Grafik Kesehatan</h2>
        </div>

        <section class="chart-card card">
            <p class="chart-title">Riwayat Detak Jantung (10 data terakhir)</p>
            <canvas id="bpmChart"></canvas>
        </section>

        <section class="chart-card card">
            <p class="chart-title">Riwayat Suhu Tubuh (10 data terakhir)</p>
            <canvas id="tempChart"></canvas>
        </section>

        <section class="chart-card card">
            <p class="chart-title">Riwayat Suhu Ruangan (10 data terakhir)</p>
            <canvas id="ambientChart"></canvas>
        </section>

        <section class="health-summary-card card">
            <h2 class="chart-title" style="text-align: center;">Rangkuman Kesehatan</h2>

            <div id="summary-status-container" class="report-status-container">
                <p>Status Keseluruhan:</p>
                <h3 id="summary-status-text" class="status-bugar">Memuat...</h3>
            </div>

            <div class="report-details">
                <h4>Detail Laporan:</h4>
                <ul id="summary-detail-list" class="report-details-list">
                    <li>Memuat data sensor...</li>
                </ul>
            </div>
        </section>

        <!-- Modal -->
        <div id="report-modal" class="modal">
          <div class="modal-content">
            <span class="close-btn" id="modal-close-btn">&times;</span>
            <h2>Rangkuman Kesehatan</h2>
            <div class="report-status-container">
              <p>Status Keseluruhan:</p>
              <h3 id="report-status" class="status-bugar">BUGAR</h3>
            </div>
            <div class="report-details">
              <h4>Detail Laporan:</h4>
              <ul id="report-detail-list"></ul>
            </div>
            <div class="report-recommendations">
              <h4>Rekomendasi (Treatment):</h4>
              <ul id="report-list"></ul>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: NEWS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-news" class="page container">
        <div class="news-banner">
          <img src="https://picsum.photos/600/300?grayscale" alt="Hot News" />
          <div class="news-banner-overlay">
            <h2>Trending Today</h2>
            <p>Update terbaru dunia health & AI</p>
          </div>
        </div>

        <h2 class="page-title">Latest News</h2>

        <div class="news-filter">
          <span class="chip active" onclick="filterNews('all', this)">All</span>
          <span class="chip" onclick="filterNews('Community', this)">Community</span>
          <span class="chip" onclick="filterNews('Health', this)">Health</span>
          <span class="chip" onclick="filterNews('Technology', this)">Technology</span>
        </div>

        <div class="news-list-container" id="news-container">
          <p class="loading-text">Memuat berita terbaru...</p>
        </div>

        <!-- News Modal -->
        <div id="newsModal" class="modal-overlay" onclick="closeModal(event)" style="display: none;">
          <div class="modal-content">
            <div class="modal-header">
              <button class="btn-back" onclick="closeModalDirect()">
                <span class="material-symbols-outlined">arrow_back</span>
              </button>
            </div>
            <img id="modalImg" src="" class="modal-img" onerror="this.src='https://picsum.photos/600/400?blur'">
            <div class="modal-body">
              <h2 id="modalTitle" class="modal-title">Loading...</h2>
              <div class="modal-meta">
                <span id="modalCategory" class="modal-category-badge">CATEGORY</span>
                <span class="modal-time">
                  <span class="material-symbols-outlined" style="font-size:16px;">schedule</span>
                  <span id="modalDate">Baru saja</span>
                </span>
              </div>
              <p id="modalDesc" class="modal-desc">Memuat konten...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: PERANGKAT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-perangkat" class="page container">
        <!-- Device Hero -->
        <div class="device-hero">
          <img src="https://cdn-icons-png.flaticon.com/512/2917/2917995.png" alt="Smart Device">
          <h2 class="device-section-title" style="margin-top: 15px;">Perangkat Saya</h2>
          <p style="color: #666; font-size: 0.95em;">Kelola koneksi perangkat kesehatan Anda</p>
        </div>

        <!-- Connected Devices Section -->
        <div id="connected-devices-container">
          <!-- Will be populated by JavaScript if device is connected -->
        </div>

        <!-- No Devices State -->
        <div class="no-devices" id="no-devices-state">
          <span class="material-symbols-outlined" style="font-size: 64px; color: #ccc; margin-bottom: 15px;">devices_off</span>
          <h3 style="color: #333; margin-bottom: 8px;">Belum Ada Perangkat</h3>
          <p style="color: #777; font-size: 0.9em; margin-bottom: 25px;">Hubungkan perangkat kesehatan Anda untuk memulai monitoring</p>

          <button class="add-device-btn" id="btn-connect-device" style="background: linear-gradient(135deg, #007BFF, #0056b3); color: white; border: none; padding: 14px 28px; border-radius: 16px; font-size: 1em; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; margin: 0 auto; box-shadow: 0 4px 15px rgba(0,123,255,0.3);">
            <span class="material-symbols-outlined">add_circle</span>
            Hubungkan Perangkat
          </button>
        </div>

        <!-- Info Cards -->
        <div style="margin-top: 30px;">
          <div class="card" style="padding: 18px; margin-bottom: 15px; background: linear-gradient(135deg, #E8F5E9, #FFF); border-left: 4px solid #27AE60;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span class="material-symbols-outlined" style="font-size: 32px; color: #27AE60;">bluetooth</span>
              <div>
                <h4 style="margin: 0 0 4px 0; font-size: 1em; color: #333;">Koneksi Bluetooth</h4>
                <p style="margin: 0; font-size: 0.85em; color: #666;">Pastikan Bluetooth aktif untuk menghubungkan perangkat</p>
              </div>
            </div>
          </div>

          <div class="card" style="padding: 18px; background: linear-gradient(135deg, #FFF3E0, #FFF); border-left: 4px solid #F39C12;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span class="material-symbols-outlined" style="font-size: 32px; color: #F39C12;">health_and_safety</span>
              <div>
                <h4 style="margin: 0 0 4px 0; font-size: 1em; color: #333;">Monitoring Real-time</h4>
                <p style="margin: 0; font-size: 0.85em; color: #666;">Data kesehatan akan ter-update secara otomatis</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- BLE Connection Modal -->
      <div id="ble-modal" class="ble-modal">
        <div class="ble-modal-content">
          <div class="ble-modal-header">
            <h3 class="ble-modal-title">Hubungkan Perangkat</h3>
            <button class="ble-close-btn" id="ble-close-btn">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>

          <div class="ble-input-group">
            <label class="ble-input-label">Nama Perangkat</label>
            <input type="text" class="ble-input" id="ble-device-name" placeholder="Contoh: ESP32-C3, CareRing Device" value="ESP32-C3">
          </div>

          <div class="ble-progress" id="ble-progress">
            <div class="ble-progress-bar"></div>
          </div>

          <button class="ble-connect-btn" id="ble-connect-btn">
            <span class="material-symbols-outlined">bluetooth_searching</span>
            Cari & Hubungkan
          </button>

          <div class="ble-message" id="ble-message"></div>

          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
            <p style="font-size: 0.85em; color: #666; margin: 0;">
              <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">info</span>
              Pastikan perangkat dalam mode pairing dan Bluetooth aktif
            </p>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: AI CHAT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-ai-chat" class="page container">
        <div class="ai-hero" style="margin: 10px auto 20px; text-align: center;">
          <div class="ai-avatar" style="width: 90px; height: 90px; border-radius: 50%; background: linear-gradient(135deg, #6aa9ff, #2d79ff); display: flex; justify-content: center; align-items: center; color: white; font-size: 42px; margin: 0 auto;">
            ğŸ¤–
          </div>
          <h2 style="margin-top: 12px; font-size: 1.4em; font-weight: 700;">CareRing AI Assistant</h2>
        </div>

        <div class="chat-container">
          <div id="chat-window" class="chat-window">
            <div class="message ai-message" style="max-width: 85%; padding: 12px 15px; border-radius: 16px; margin-bottom: 12px; background: #e9f2ff; color: #084c9e;">
              <p>Halo! Saya adalah Bot CARERING. Tanyakan saya tentang data kesehatan Anda.</p>
            </div>
          </div>

          <div id="suggested-questions" class="suggested-questions" style="display: flex; gap: 10px; overflow-x: auto; margin: 15px 0;">
            <button class="suggest-btn" style="background: #f1f5ff; border: none; padding: 10px 16px; border-radius: 16px; white-space: nowrap; font-size: 0.87em; color: #2d79ff; cursor: pointer;">Bagaimana suhu tubuh saya?</button>
            <button class="suggest-btn" style="background: #f1f5ff; border: none; padding: 10px 16px; border-radius: 16px; white-space: nowrap; font-size: 0.87em; color: #2d79ff; cursor: pointer;">Detak jantung saya normal?</button>
            <button class="suggest-btn" style="background: #f1f5ff; border: none; padding: 10px 16px; border-radius: 16px; white-space: nowrap; font-size: 0.87em; color: #2d79ff; cursor: pointer;">Apa itu hipotermia?</button>
          </div>

          <form id="chat-form" class="chat-form" style="display: flex; align-items: center; background: rgba(255,255,255,0.8); border-radius: 18px; padding: 10px 15px; margin-top: 5px; box-shadow: 0 8px 25px rgba(0,0,0,0.08);">
            <input type="text" id="chat-input" placeholder="Ketik pesan Anda..." required style="flex: 1; border: none; font-size: 1em; outline: none; background: transparent;">
            <button type="submit" id="send-btn" style="width: 42px; height: 42px; border-radius: 50%; border: none; background: #007bff; color: white; display: flex; justify-content: center; align-items: center; cursor: pointer;">
              <span class="material-symbols-outlined">send</span>
            </button>
          </form>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: FORUM
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-forum" class="page container">
        <div class="page-header-container" style="background: linear-gradient(145deg, #007BFF, #0097ff, #53b8ff); padding: 28px 20px; margin: -10px -10px 25px -10px; border-radius: 0 0 25px 25px; color: white;">
          <h2 class="page-title" style="font-size: 22px; font-weight: 800; margin: 0;">Forum Diskusi</h2>
        </div>

        <div class="forum-list-container">
          <a href="#" class="list-item-card" style="display: flex; align-items: flex-start; background: rgba(255, 255, 255, 0.9); padding: 18px; margin-bottom: 14px; border-radius: 16px; text-decoration: none; color: #222;">
            <div class="list-item-icon" style="width: 55px; height: 55px; border-radius: 14px; display: flex; justify-content: center; align-items: center; font-size: 28px; margin-right: 15px; background-color: #dcecff; color: #007BFF;">
              <span class="material-symbols-outlined">question_answer</span>
            </div>
            <div class="list-item-content">
              <h3 style="margin: 0; font-size: 16.5px; font-weight: 600;">Apa itu Hipotermia?</h3>
              <p class="list-item-meta" style="font-size: 13px; color: #666; margin-top: 6px;">Oleh Erico Varel â€¢ 2 Balasan</p>
            </div>
            <span class="material-symbols-outlined list-item-chevron" style="margin-left: auto; color: #ccc; font-size: 28px;">chevron_right</span>
          </a>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PAGE: PROFIL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="page-profil" class="page container">
        <h2 class="profile-page-title" style="text-align: center; margin-bottom: 20px; font-size: 1.8em; color: #333;">Profil</h2>

        <div class="profile-card" style="background-color: #fff; border-radius: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); padding: 30px 20px; margin: 20px auto; text-align: center; max-width: 350px;">
          <div class="profile-avatar-large" style="width: 80px; height: 80px; border-radius: 50%; background-color: #E6F2FF; color: #007BFF; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto; font-size: 40px; position: relative; overflow: hidden;">
            <img id="profil-img" src="" alt="Foto Profil" style="width: 100%; height: 100%; object-fit: cover; display: none;" onload="this.style.display='block'; document.getElementById('profil-default-icon').style.display='none';">
            <span class="material-symbols-outlined" id="profil-default-icon">person</span>
          </div>

          <h3 id="profil-nama" style="font-size: 1.5em; margin-bottom: 5px; color: #333;">Memuat...</h3>
          <p id="profil-email" style="font-size: 0.9em; color: #777; margin-bottom: 25px;">Memuat...</p>

          <div class="profile-detail-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; font-size: 0.95em; color: #555;">
            <span class="profile-detail-label" style="font-weight: 500; color: #333;">Perangkat Terhubung:</span>
            <span class="profile-detail-value">
              <span id="profile-device-lastseen" class="status-loading">ESP32-C3</span>
            </span>
          </div>
          <div class="profile-detail-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; font-size: 0.95em; color: #555;">
            <span class="profile-detail-label" style="font-weight: 500; color: #333;">Member Sejak:</span>
            <span class="profile-detail-value">2025</span>
          </div>
          <div class="profile-detail-row" style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; margin-bottom: 20px; font-size: 0.95em; color: #555;">
            <span class="profile-detail-label" style="font-weight: 500; color: #333;">Status Akun:</span>
            <span class="profile-detail-value" style="color: green; font-weight:600;">Aktif</span>
          </div>
        </div>

        <a href="#" class="logout-btn-card" id="btn-logout" style="display: flex; align-items: center; background-color: #fff; border-radius: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); padding: 15px 20px; margin: 30px auto; max-width: 350px; cursor: pointer; text-decoration: none; color: inherit;">
          <div class="list-item-icon" style="background-color: #FFF0F0; color: #E74C3C; margin-right: 15px; width: 55px; height: 55px; border-radius: 14px; display: flex; justify-content: center; align-items: center;">
            <span class="material-symbols-outlined">logout</span>
          </div>
          <h3 style="margin: 0; font-size: 1.1em; color: #E74C3C; flex-grow: 1; text-align: left;">Keluar</h3>
          <span class="material-symbols-outlined list-item-chevron" style="color: #E74C3C;">chevron_right</span>
        </a>
      </div>

    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         BOTTOM NAVIGATION (Persisten - Always visible)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="bottom-nav">
      <div class="nav-item active" data-navigate="home">
        <div class="nav-icon"><span class="material-symbols-outlined">home</span></div>
        <div class="nav-label">Home</div>
      </div>
      <div class="nav-item" data-navigate="news">
        <div class="nav-icon"><span class="material-symbols-outlined">newspaper</span></div>
        <div class="nav-label">News</div>
      </div>
      <div class="nav-item" data-navigate="perangkat">
        <div class="nav-icon"><span class="material-symbols-outlined">devices</span></div>
        <div class="nav-label">Perangkat</div>
      </div>
      <div class="nav-item" data-navigate="ai-chat">
        <div class="nav-icon"><span class="material-symbols-outlined">smart_toy</span></div>
        <div class="nav-label">AI Chat</div>
      </div>
      <div class="nav-item" data-navigate="forum">
        <div class="nav-icon"><span class="material-symbols-outlined">forum</span></div>
        <div class="nav-label">Forum</div>
      </div>
      <div class="nav-item" data-navigate="profil">
        <div class="nav-icon"><span class="material-symbols-outlined">person</span></div>
        <div class="nav-label">Profil</div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FIREBASE & SCRIPTS - Load sekali, persist selamanya!
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
 <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script src="script.js"></script>
  <script src="auth-guard.js"></script>
  <script src="ble-handler.js"></script>
  <script src="ble-indicator.js"></script>

  <script>
    (function() {
      'use strict';
      console.log('ğŸš€ SPA Router initialized');

      let currentPage = 'home';

      // --- NAVIGASI HALAMAN ---
      function navigateToPage(pageName) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        const targetPage = document.getElementById(`page-${pageName}`);
        if (targetPage) {
          targetPage.classList.add('active');
          currentPage = pageName;
          updateNavigation(pageName);
          window.location.hash = pageName;
          window.scrollTo(0, 0);
          initializePage(pageName);
        }
      }

      function updateNavigation(pageName) {
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        const activeNav = document.querySelector(`.nav-item[data-navigate="${pageName}"]`);
        if (activeNav) activeNav.classList.add('active');
      }

      function initializePage(pageName) {
        switch(pageName) {
          case 'home': break;
          case 'news': if (typeof loadNews === 'function') loadNews(); break;
          case 'perangkat': initPerangkatPage(); break;
          case 'ai-chat':
            // Panggil fungsi chat bot
            if (typeof window.initAIChat === 'function') window.initAIChat();
            break;
          case 'forum': break;
          case 'profil': break;
        }
      }

      // --- LOGIKA PERANGKAT (BLE) ---
      function initPerangkatPage() {
        const modal = document.getElementById('ble-modal');
        const btnConnect = document.getElementById('btn-connect-device');
        const btnClose = document.getElementById('ble-close-btn');
        const btnBLEConnect = document.getElementById('ble-connect-btn');
        const bleProgress = document.getElementById('ble-progress');
        const bleMessage = document.getElementById('ble-message');
        const deviceNameInput = document.getElementById('ble-device-name');

        if (btnConnect) btnConnect.onclick = () => { modal.classList.add('show'); bleMessage.classList.remove('show'); };
        if (btnClose) btnClose.onclick = () => modal.classList.remove('show');
        if (modal) modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('show'); };

        if (btnBLEConnect) {
          btnBLEConnect.onclick = async () => {
            try {
              bleProgress.classList.add('show');
              bleMessage.classList.remove('show');
              btnBLEConnect.innerHTML = 'Menghubungkan...';
              
              if (window.BLEHandler && window.BLEHandler.connect) {
                await window.BLEHandler.connect();
                bleProgress.classList.remove('show');
                bleMessage.className = 'ble-message show success';
                bleMessage.textContent = 'âœ… Terhubung!';
                setTimeout(() => { modal.classList.remove('show'); updateDeviceUI(); }, 2000);
              }
            } catch (error) {
              bleProgress.classList.remove('show');
              bleMessage.className = 'ble-message show error';
              bleMessage.textContent = 'Gagal: ' + error.message;
              btnBLEConnect.innerHTML = 'Coba Lagi';
            }
          };
        }
        updateDeviceUI();
      }

      function updateDeviceUI() {
        const container = document.getElementById('connected-devices-container');
        const noDev = document.getElementById('no-devices-state');
        if (!container || !noDev) return;

        if (window.BLEHandler && window.BLEHandler.isConnected && window.BLEHandler.isConnected()) {
             const info = window.BLEHandler.getDeviceInfo();
             noDev.style.display = 'none';
             container.innerHTML = `<div class="device-card">Connected: ${info.name} <button onclick="window.disconnectDevice()" style="color:red">Putus</button></div>`;
        } else {
             noDev.style.display = 'block';
             container.innerHTML = '';
        }
      }

      window.disconnectDevice = function() {
          if (confirm('Putuskan koneksi?')) {
              if (window.BLEHandler) window.BLEHandler.disconnect();
              updateDeviceUI();
          }
      };

      document.querySelectorAll('[data-navigate]').forEach(el => {
        el.addEventListener('click', (e) => { e.preventDefault(); navigateToPage(el.getAttribute('data-navigate')); });
      });
      window.addEventListener('hashchange', () => { const h = window.location.hash.slice(1); if(h) navigateToPage(h); });
      document.addEventListener('DOMContentLoaded', () => { const h = window.location.hash.slice(1); navigateToPage(h || 'home'); });
      window.navigateToPage = navigateToPage;
    })();
  </script>

<script>
    window.initAIChat = function() {
        console.log("ğŸ¤– Smart Bot Loaded");
        const chatInput = document.getElementById('chat-input');
        const chatForm = document.getElementById('chat-form');
        const suggestBtns = document.querySelectorAll('.suggest-btn');
        
        if (!chatInput) return;

        // Reset Tombol Saran
        suggestBtns.forEach(btn => {
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);
            newBtn.addEventListener('click', function() {
                document.getElementById('chat-input').value = this.innerText;
                window.handleChatSubmit();
            });
        });

        // Reset Form Submit
        if (chatForm) {
            const newForm = chatForm.cloneNode(true);
            chatForm.parentNode.replaceChild(newForm, chatForm);
            newForm.addEventListener('submit', function(e) {
                e.preventDefault();
                window.handleChatSubmit();
            });
        }
    };

    // --- OTAK BOT PINTAR ---
    window.handleChatSubmit = function() {
        const chatInput = document.getElementById('chat-input');
        const message = chatInput.value.trim();
        if (!message) return;

        // 1. Tampilkan pesan User
        appendMessage('user', message);
        chatInput.value = '';

        // 2. Tampilkan Loading
        const loadingId = appendMessage('ai', 'Sedang memeriksa data kesehatan Anda...');

        // 3. Proses Jawaban (Delay 0.8 detik agar terasa natural)
        setTimeout(() => {
            const loadingEl = document.getElementById(loadingId);
            if (loadingEl) loadingEl.remove();

            let jawaban = "";
            const textLower = message.toLowerCase();

            // === AMBIL DATA REAL DARI HOME (Sesuai ID di HTML kamu) ===
            const elemenSuhu = document.getElementById('suhu-tubuh-value');
            const elemenJantung = document.getElementById('home-heartrate');

            // Ambil teksnya (misal "36.5" atau "--")
            const dataSuhu = elemenSuhu ? elemenSuhu.innerText : "--";
            const dataJantung = elemenJantung ? elemenJantung.innerText : "--";

            // === LOGIKA JAWABAN ===
            if (textLower.includes("suhu")) {
                // Cek apakah data tersedia (bukan "--")
                if(dataSuhu === "--") {
                    jawaban = "Maaf, sensor suhu belum terhubung. Silakan hubungkan perangkat di menu 'Perangkat' terlebih dahulu.";
                } else {
                    jawaban = `Suhu tubuh Anda saat ini terdeteksi **${dataSuhu}Â°C**. `;
                    const angka = parseFloat(dataSuhu);
                    if(angka > 37.5) jawaban += "Suhu Anda agak tinggi. Pastikan istirahat cukup dan banyak minum air.";
                    else if(angka < 35) jawaban += "Hati-hati, suhu tubuh terlalu rendah (Hipotermia). Segera hangatkan tubuh.";
                    else jawaban += "Suhu tubuh Anda dalam batas **Normal**.";
                }
            } 
            else if (textLower.includes("jantung") || textLower.includes("detak")) {
                if(dataJantung === "--") {
                    jawaban = "Maaf, sensor detak jantung belum aktif. Mohon cek koneksi perangkat Anda.";
                } else {
                    jawaban = `Detak jantung Anda saat ini adalah **${dataJantung} BPM**. `;
                    const angka = parseFloat(dataJantung);
                    if(angka > 100) jawaban += "Detak jantung cukup cepat. Jika Anda sedang istirahat, cobalah rileks sejenak.";
                    else if(angka < 60) jawaban += "Detak jantung lambat (Bradikardia), ini normal jika Anda sering berolahraga.";
                    else jawaban += "Detak jantung Anda **Normal**.";
                }
            } 
            else if (textLower.includes("hipotermia")) {
                jawaban = "Hipotermia adalah kondisi darurat medis ketika suhu tubuh turun drastis di bawah 35Â°C. Gejalanya meliputi menggigil hebat, bicara melantur, dan napas pendek.";
            }
            else if (textLower.includes("halo") || textLower.includes("hai")) {
                jawaban = "Halo! Saya asisten CareRing. Saya bisa membacakan data sensor Anda langsung dari perangkat. Coba tanya: 'Berapa suhu saya?'";
            }
            else {
                jawaban = "Maaf, saya belum mengerti. Coba tanyakan tentang **Suhu Tubuh**, **Detak Jantung**, atau **Hipotermia**.";
            }

            // Tampilkan Jawaban
            appendMessage('ai', jawaban);
            
        }, 800); 
    };

    // Helper: Buat Bubble Chat Cantik
    function appendMessage(sender, text) {
        const cw = document.getElementById('chat-window');
        if (!cw) return;
        const div = document.createElement('div');
        div.id = 'msg-' + Date.now();
        
        // Class CSS yang sudah diperbarui
        div.className = sender === 'user' ? 'message user-message' : 'message ai-message';
        
        // Convert **text** jadi bold dan \n jadi enter
        let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, "<br>");
        div.innerHTML = formattedText;
        
        cw.appendChild(div);
        cw.scrollTop = cw.scrollHeight;
        return div.id;
    }
 </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js'));
    }
  </script>